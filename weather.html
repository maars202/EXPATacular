<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Weather</title>
     <!-- Axios API -->
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
     <!-- Leaflet Maps -->
     <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
     <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
     <link rel="stylesheet" href="css/styles.css"/>
     <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.0/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-KyZXEAg3QhqLMpG8r+8fhAXLRk2vvoC2f3B09zVXn8CA5QIVfZOJ3BCsw2P0p/We" crossorigin="anonymous">

    <div class="container-fluid"> 
        <!-- NAVBAR -->
        <div class="row" style = "background-color:#F2F2F2;">
            <nav class="ps-sm-0 ps-md-5 navbar navbar-expand-md navbar-light pt-md-4 pt-sm-5 fixed-top" style = "background-color:#F2F2F2;">
                <div class="container-fluid ps-3">
                    <!-- <a class="navbar-brand" href="#">Navbar</a> -->
                    <button class="navbar-toggler m-0" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNavDropdown" aria-controls="navbarNavDropdown" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                    </button>
                    <div class="collapse navbar-collapse" id="navbarNavDropdown">
                    <ul class="navbar-nav">
                        <li class="nav-item">
                        <a class="nav-link active" aria-current="page" href="./index.html">Home</a>
                        </li>
                        <li class="nav-item">
                        <a class="nav-link" href="./about_page.html">About</a>
                        </li>
                        <li class="nav-item">
                        <a class="nav-link" href="./Forum/forum.html">Community</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="./foodAndPlaces.html">Food & Places</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="./trivia.html">Trivia!</a>
                        </li>
                        <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" id="navbarDropdownMenuLink" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                            Tools
                        </a>
                        <ul class="dropdown-menu" aria-labelledby="navbarDropdownMenuLink">
                            <li><a class="dropdown-item" href="./tools.html">Dashboard</a></li>
                            <li><a class="dropdown-item" href="#">Currency Converter</a></li>
                            <li><a class="dropdown-item" href="./emergency_contact.html">Emergency Contacts</a></li>
                            <li><a class="dropdown-item" href="#">Translator</a></li>
                            <li><a class="dropdown-item" href="./weather.html">Weather Forecast</a></li>
                            <li><a class="dropdown-item" href="./covid.html">Covid Stats</a></li>
                        </ul>
                        </li>
                    </ul>
                    </div>
                </div>
            </nav>

        </div>
        <!-- NAVBAR -->
    
</head>
<body>

     <style>
        #mapid { 
            height: 480px;
            width: 1025px; 
       }
    </style>


 <!--  background image -->  
<div class="bg-image justify-content-center align-items-center img-responsive  " style="background-image: url('./covidweatherresources/backgroundimage.jpg');background-size: cover;">
    <div class="container-fluid " style = "padding-top: 10%; padding-bottom: 10%;">
  
     <h1 class="text-center">Weather</h1>
     <p class="text-center pb-4">Check the weather before heading out!</p>   
 
 <!--  Grid -->  
 <div class="bg-white opacity-75 m-5  justify-content-center">
    <div class="row   "  style = "padding-top: 5%; padding-bottom: 2%;">
        <div class="col-1"></div>
        <div class="col-10">
        <table class="table table-hover">
            <thead  class="text-center">
              <tr>
                <th scope="col">Location</th>
                <th scope="col">Temperature (°C)</th>
                <th scope="col">Humidity (%)</th>
                <th scope="col">Wind Speed (kn)</th>
              </tr>
            </thead>
            <tbody class="text-center">
            <tr id="rowone"></tr>
              <tr id="rowtwo"></tr>
              <tr id="rowthree"></tr>
              <tr id="rowfour"></tr>
              <tr id="rowfive"></tr>
            </tbody>
          </table>
        </div>
        <div class="col-1"></div>
      </div>
    </div>
    <div class="row justify-content-center"  style = "padding-bottom: 5%;">
    <div id="mapid"></div>
    </div>
    
    
</div> 
</div>


<!-- Rainfall map/ location/temp/humid/windspeed table -->
    <script>
        // rainfall
    axios.get('https://api.data.gov.sg/v1/environment/rainfall')
    .then( response =>  {
        stations_list = response.data.metadata.stations
        unit = response.data.metadata.reading_unit
        datetime = response.data.items[0].timestamp
        readings_list = response.data.items[0].readings   
        d = new Date()
        time = d.getHours()
        for (station of stations_list){
            for (reading of readings_list){
                if(reading.station_id == station.id && (station.name.slice(0,2) != "S2")){
                    // console.log(station.name)
                    // console.log(station.location.latitude + ","+station.location.longitude)
                    // console.log(reading.value)
                    if (((reading.value == 0)) && (time>7) && (time<=18)){
                    var sunny = L.marker([station.location.latitude,station.location.longitude],{icon:sunicon}).addTo(mymap)
                    sunny.bindPopup("<b>It's sunny around "+ station.name +"!</b>")
                    }
                    else if (reading.value > 0 && (time>7) && (time<=18)){
                        var rainy = L.marker([station.location.latitude,station.location.longitude],{icon:rainicon}).addTo(mymap)
                        rainy.bindPopup("<b>It's rainy around "+ station.name +"!</b>")
                    }
                    else if (reading.value == 0 && (time>=18 || time<= 7)){
                        var night = L.marker([station.location.latitude,station.location.longitude],{icon:nighticon}).addTo(mymap)
                        night.bindPopup("<b>Moon's shining bright around "+ station.name +"!</b>")
                    }
                    else if (reading.value > 0 && (time>=18 || time<= 7)){
                        var nightrain =  L.marker([station.location.latitude,station.location.longitude],{icon:nightrainicon}).addTo(mymap)
                        nightrain.bindPopup("<b>It's a rainy night around "+ station.name +"!</b>")
                    }

                }
            }  
        }  
        
    } )
    .catch(error => {
        console.log(error.message)   
    });  
    // Map Settings
    var mymap = L.map('mapid').setView([1.3521, 103.8198], 11);
L.tileLayer('https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token=pk.eyJ1Ijoic29vbmhhbyIsImEiOiJja3VqdnNtMngwbWExMm9wOHN0czJ0aGhlIn0.c7Tlc8lswiBqtTd4CLNEHw', {
    attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors, Imagery © <a href="https://www.mapbox.com/">Mapbox</a>',
    maxZoom: 17,
    id: 'mapbox/streets-v11',
    tileSize: 512,
    zoomOffset: -1,
    accessToken: 'pk.eyJ1Ijoic29vbmhhbyIsImEiOiJja3VqdnNtMngwbWExMm9wOHN0czJ0aGhlIn0.c7Tlc8lswiBqtTd4CLNEHw'
}).addTo(mymap);
var sunicon = L.icon({
    iconUrl: './covidweatherresources/sun.svg',
    iconSize:     [15, 15], // size of the icon
    shadowSize:   [50, 64], // size of the shadow
    iconAnchor:   [0, 10], // point of the icon which will correspond to marker's location
    shadowAnchor: [4, 62],  // the same for the shadow
    popupAnchor:  [0, 0] // point from which the popup should open relative to the iconAnchor
});
var rainicon = L.icon({
    iconUrl: './covidweatherresources/rain.svg',
    iconSize:     [15, 15], // size of the icon
    shadowSize:   [50, 64], // size of the shadow
    iconAnchor:   [0, 10], // point of the icon which will correspond to marker's location
    shadowAnchor: [4, 62],  // the same for the shadow
    popupAnchor:  [0, 0] // point from which the popup should open relative to the iconAnchor
});
var nighticon = L.icon({
    iconUrl: './covidweatherresources/night.png',
    iconSize:     [15, 15], // size of the icon
    shadowSize:   [50, 64], // size of the shadow
    iconAnchor:   [0, 10], // point of the icon which will correspond to marker's location
    shadowAnchor: [4, 62],  // the same for the shadow
    popupAnchor:  [0, 0] // point from which the popup should open relative to the iconAnchor
});

var nightrainicon = L.icon({
    iconUrl: './covidweatherresources/nightrain.png',
    iconSize:     [15, 15], // size of the icon
    shadowSize:   [50, 64], // size of the shadow
    iconAnchor:   [0, 10], // point of the icon which will correspond to marker's location
    shadowAnchor: [4, 62],  // the same for the shadow
    popupAnchor:  [0, 0] // point from which the popup should open relative to the iconAnchor
});


let one = "https://api.data.gov.sg/v1/environment/air-temperature"
let two = "https://api.data.gov.sg/v1/environment/relative-humidity"
let three = "https://api.data.gov.sg/v1/environment/wind-speed"
const requestOne = axios.get(one);
const requestTwo = axios.get(two);
const requestThree = axios.get(three);
 
axios.all([requestOne, requestTwo, requestThree]).then(axios.spread((...response) => {
  datetime = response[0].data.items[0].timestamp
  temp_stations_list = response[0].data.metadata.stations
  temp_readings_list = response[0].data.items[0].readings 
  humid_stations_list = response[1].data.metadata.stations
  humid_readings_list = response[1].data.items[0].readings  
  wind_stations_list = response[2].data.metadata.stations
  wind_readings_list = response[2].data.items[0].readings  


  for (station of temp_stations_list){
            for (reading of temp_readings_list){
                if(reading.station_id == station.id){
                    // console.log(station.name)
                    // console.log(station.location.latitude + ","+station.location.longitude)
                    // console.log(reading.value)
                    // L.marker([station.location.latitude,station.location.longitude]).addTo(mymap)
                    th = document.createElement("th") 
                    td = document.createElement("td") 
                    if (station.name == "Woodlands Avenue 9"){
                        var textname = "North"
                        node = document.createTextNode(textname)
                        th.appendChild(node)
                        node2 = document.createTextNode(reading.value)
                        td.appendChild(node2)
                        document.getElementById("rowone").appendChild(th)
                        document.getElementById("rowone").appendChild(td)
                    }
                    if (station.name == "West Coast Highway"){
                        var textname = "South"
                        node = document.createTextNode(textname)
                        th.appendChild(node)
                        node2 = document.createTextNode(reading.value)
                        td.appendChild(node2)
                        document.getElementById("rowtwo").appendChild(th)
                        document.getElementById("rowtwo").appendChild(td)
                    }
                    if (station.name == "Pulau Ubin"){
                        var textname = "East"
                        node = document.createTextNode(textname)
                        th.appendChild(node)
                        node2 = document.createTextNode(reading.value)
                        td.appendChild(node2)
                        document.getElementById("rowthree").appendChild(th)
                        document.getElementById("rowthree").appendChild(td)
                    }
                    if (station.name == "Nanyang Avenue"){
                    var textname = "West"
                        node = document.createTextNode(textname)
                        th.appendChild(node)
                        node2 = document.createTextNode(reading.value)
                        td.appendChild(node2)
                        document.getElementById("rowfour").appendChild(th)
                        document.getElementById("rowfour").appendChild(td)
                    }
                    if (station.name == "Clementi Road"){
                        var textname = "Central"
                        node = document.createTextNode(textname)
                        th.appendChild(node)
                        node2 = document.createTextNode(reading.value)
                        td.appendChild(node2)
                        document.getElementById("rowfive").appendChild(th)
                        document.getElementById("rowfive").appendChild(td)
                    }  
                }
            }  
        }  
  

        for (station of humid_stations_list){
            for (reading of humid_readings_list){
                if(reading.station_id == station.id){
                    // console.log(station.name)
                    // console.log(station.location.latitude + ","+station.location.longitude)
                    // console.log(reading.value)
                    td = document.createElement("td") 
                    if (station.name == "Woodlands Avenue 9"){
                        node = document.createTextNode(reading.value)
                        td.appendChild(node)
                        document.getElementById("rowone").appendChild(td)
                    }
                    if (station.name == "West Coast Highway"){
                        node = document.createTextNode(reading.value)
                        td.appendChild(node)
                        document.getElementById("rowtwo").appendChild(td)
                    }
                    if (station.name == "Pulau Ubin"){
                        node = document.createTextNode(reading.value)
                        td.appendChild(node)
                        document.getElementById("rowthree").appendChild(td)
                    }
                    if (station.name == "Nanyang Avenue"){
                    node = document.createTextNode(reading.value)
                        td.appendChild(node)
                        document.getElementById("rowfour").appendChild(td)
                    }
                    if (station.name == "Clementi Road"){
                        var textname = "Central"
                        node = document.createTextNode(reading.value)
                        td.appendChild(node)
                        document.getElementById("rowfive").appendChild(td)
                    }  
                    
                }
            }  
        }  
        for (station of wind_stations_list){
            for (reading of wind_readings_list){
                if(reading.station_id == station.id){
                    // console.log(station.name)
                    // console.log(station.location.latitude + ","+station.location.longitude)
                    // console.log(reading.value)
                    td = document.createElement("td") 
                    if (station.name == "Woodlands Avenue 9"){
                        node = document.createTextNode((Math.round(reading.value * 100)/100))
                        td.appendChild(node)
                        document.getElementById("rowone").appendChild(td)
                    }
                    if (station.name == "West Coast Highway"){
                        node = document.createTextNode((Math.round(reading.value * 100)/100))
                        td.appendChild(node)
                        document.getElementById("rowtwo").appendChild(td)
                    }
                    if (station.name == "Pulau Ubin"){
                        node = document.createTextNode((Math.round(reading.value * 100)/100))
                        td.appendChild(node)
                        document.getElementById("rowthree").appendChild(td)
                    }
                    if (station.name == "Nanyang Avenue"){
                    node = document.createTextNode((Math.round(reading.value * 100)/100))
                        td.appendChild(node)
                        document.getElementById("rowfour").appendChild(td)
                    }
                    if (station.name == "Clementi Road"){
                        var textname = "Central"
                        node = document.createTextNode((Math.round(reading.value * 100)/100))
                        td.appendChild(node)
                        document.getElementById("rowfive").appendChild(td)
                    }  
                    
                }
            }  
        }  
})).catch(errors => {
  // react on errors.
})   


</script>


<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.0/dist/js/bootstrap.bundle.min.js" integrity="sha384-U1DAWAznBHeqEIlVSCgzq+c9gqGAJn5c/t99JyeKa9xxaYpSvHU5awsuZVVFIhvj" crossorigin="anonymous"></script>   
</body>
</html>
